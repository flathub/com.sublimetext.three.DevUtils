---
id: com.sublimetext.three.DevUtils
branch: "19.08"
build-extension: true

runtime: com.sublimetext.three
runtime-version: stable
sdk: org.freedesktop.Sdk//19.08
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node12

separate-locales: false
appstream-compose: false
build-options:
  prefix: /app/utils
  env:
    PATH: /usr/lib/sdk/node12/bin:/app/utils/bin:/app/bin:/usr/bin
    PYTHONPATH: /app/utils/lib/python3.7/site-packages:/app/lib/python3.7/site-packages:/usr/lib/python3.7/site-packages

modules:
  - python3-pycodestyle.json
  - python3-pyflakes.json
  - python3-yamllint.json
  - name: nodejs
    buildsystem: simple
    build-commands:
      - install -Dm 755 /usr/lib/sdk/node12/bin/node /app/utils/bin/node
  - name: js-packages
    buildsystem: simple
    sources:
      # These files are autogenerated by:
      # npm init
      # npm install --save csslint eslint jshint prettier
      # flatpak-node-generator.py npm package-lock.json
      #
      # To update, delete node_modules and package-lock.json, run `npm install`,
      # and re-run `flatpak-node-generator.py npm package-lock.json`.
      - generated-sources.json
      - type: file
        path: package.json
      - type: file
        path: package-lock.json
    build-commands:
      - mkdir -p dest /app/utils/lib
      - cp package.json package-lock.json dest
      - npm install --prefix=dest --offline --cache=$FLATPAK_BUILDER_BUILDDIR/flatpak-node/npm-cache
      - cp -ra dest/* /app/utils/lib/
      - rm -rf dest
      - ln -s /app/utils/lib/node_modules/.bin/* /app/utils/bin
  - name: compose-appstream-data
    buildsystem: simple
    sources:
      - type: file
        path: com.sublimetext.three.DevUtils.appdata.xml
    build-commands:
      - install -Dm644 com.sublimetext.three.DevUtils.appdata.xml /app/utils/share/appdata/com.sublimetext.three.DevUtils.appdata.xml
      - appstream-compose --basename=com.sublimetext.three.DevUtils --prefix=${FLATPAK_DEST} --origin=flatpak com.sublimetext.three.DevUtils
