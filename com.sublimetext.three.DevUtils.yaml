---
id: com.sublimetext.three.DevUtils
branch: "18.08"
build-extension: true

runtime: com.sublimetext.three
runtime-version: stable
sdk: org.freedesktop.Sdk//18.08

separate-locales: false
appstream-compose: false
build-options:
  prefix: /app/utils
  env:
    PATH: /app/utils/bin:/app/bin:/usr/bin
    PYTHONPATH: /app/utils/lib/python3.5/site-packages:/app/lib/python3.5/site-packages:/usr/lib/python3.5/site-packages

modules:
  - python3-pycodestyle.json
  - python3-pyflakes.json
  - python3-yamllint.json
  - name: nodejs
    cleanup:
      - /include
      - /share
      - /app/lib/node_modules/npm/changelogs
      - /app/lib/node_modules/npm/doc
      - /app/lib/node_modules/npm/html
      - /app/lib/node_modules/npm/man
      - /app/lib/node_modules/npm/scripts
    sources:
      - type: archive
        url: https://nodejs.org/dist/v10.16.2/node-v10.16.2.tar.xz
        sha256: 6cbc17795e9259dce7a8f5fd5a2e46f9e6920fb48b7d9539c5b2faa5bb5db4d8
  - name: js-packages
    buildsystem: simple
    sources:
      # These files are autogenerated by:
      # npm init
      # npm install --save csslint eslint jshint
      # flatpak-npm-generator.py package-lock.json
      #
      # To update, delete node_modules and package-lock.json, run `npm install`,
      # and re-run `flatpak-npm-generator.py package-lock.json`.
      - generated-sources.json
      - type: file
        path: package.json
      - type: file
        path: package-lock.json
    build-commands:
      - mkdir -p dest /app/utils/lib
      - cp package.json package-lock.json dest
      - npm install --prefix=dest --offline --cache=/run/build/js-packages/npm-cache
      - cp -ra dest/* /app/utils/lib/
      - rm -rf dest
      - ln -s /app/utils/lib/node_modules/.bin/* /app/utils/bin
  - name: compose-appstream-data
    buildsystem: simple
    sources:
      - type: file
        path: com.sublimetext.three.DevUtils.appdata.xml
    build-commands:
      - install -Dm644 com.sublimetext.three.DevUtils.appdata.xml /app/utils/share/appdata/com.sublimetext.three.DevUtils.appdata.xml
      - appstream-compose --basename=com.sublimetext.three.DevUtils --prefix=${FLATPAK_DEST} --origin=flatpak com.sublimetext.three.DevUtils
